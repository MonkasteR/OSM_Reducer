# OSM_Reducer
## Уменьшаем размер карт для использования в Такси Мастер

Уменьшаем размер OSM-карт польского формата (*.mp) для использования серевере карт Такси Мастер

Конфигурационные файлы:

* `in_files.txt` - содержит перечень файлов, которые мы обрабатываем. По одному в каждой строке.

* `values_to_address.txt` - содержит обязательные для использования аттрибуты. Если они будут найдены в обрабатываемом блоке текста, то такой блок не удалится, ибо полезен.

* `values_to_check.txt`   - содержит значения ненужные нам. Если в блоке текста мы находим такое, то блок текста полностью удаляется.

* `values_to_replace.txt` - содержит значения которые мы удаляем из текстового блока и записываем результирующий блок текста без этих строк.

 **Как это работает в общих чертах и что надо менять**

 Все что вам надо сделать это в файл `in_files.txt` занести карты которые вам надо обработать.
 Чем больше карт надо обработать, тем лучше. Используется многопоточность, так что 10 карт одновременно обработаются в 10 шустрее, чем 10 карт по одной.
 Облегченные таким образом карты можно пачкой загружать в тот же **[GPSMapEdit](https://www.geopainting.com/)** и там их объединить.
 
Берем все карты из `in_files.txt` и обрабатываем их в несколько потоков. Если количество карт равно количеству ядер у вашего процессора, то очень хорошо.
Берем из карты по-очереди блоки текста:

```
; NodeID = 9076609077
; Addressed by WayID = 161733161
; shop = outpost
[POI]
Data0=(55.0816852,38.80344)
Type=0x2E0A
Label=Ozon
CityName=Коломна
CountryName=Россия
HouseNumber=3А
Phone=+7 800 2347000
RegionName=Московская область
StreetDesc=Окский проспект
[END]
```

Работаем с ними. Проверяем на наличие строк из `values_to_replace.txt` и удаляем их.
Например, нам не нужны такие строки как `Phone`, `Text` или `ZipCode`.
Они удаляются и блок текста уже без этих лишних строк записывается в выходной файл.

Берем следующий блок текста и обрабатываем его:

```
; WayID = 790825996
; waterway = drain
[POLYLINE]
Data0=(56.7079882,37.9707216),(56.7079982,37.9705552),(56.7082778,37.9659015)
Type=0x2a
Label=
[END]
```
Если в таком блоке мы находим строку `waterway = drain`, то весь блока текста удаляется. Нам же не нужен на карте дренаж, водоводы и прочее непотребство. Все эти строки уже описаны в `values_to_check.txt`.

Работаем со следующими блоками текста:

```
; WayID = 393912978
; building = yes
[POLYGON]
Data0=(56.3965829,38.8919078),(56.3965805,38.8919437),(56.3965412,38.8919351),(56.3965436,38.8918992),(56.3965829,38.8919078)
Type=0x13
Label=
[END]
```
Это полигон. Здание. На карте он виден квадратиком и вроде все нормально. Но он не содержит нужных нам элементов, которые хранятся в `values_to_address.txt` и мы его удаляем.
На не нужен нарисованный полигон, у которого нет адреса и названия. Ведь мы его не найдем в поиске и приехать к такой точке не можем.
